function [LOLP,EENS]=problem4_3(rate)
p0 =[
    400 400 350 ...
    197 197 197 ...
    155 155 155 155 ...
    100 100 100 ...
    76 76 76 76 ...
    50 50 50 50 50 50 ...
    20 20 20 20 ...
    12 12 12 12 12 ...
    ];
qa = [0.8795 0.8795 0.9202 0.9501 0.9501 0.9501 0.9601 0.9601 0.9601 0.9601 ...
    0.9600 0.9600 0.9600 0.9799 0.9799 0.9799 0.9799 0.9901 0.9901 0.9901 0.9901 ...
    0.9901 0.9901 0.8998 0.8998 0.8998 0.8998 0.9799 0.9799 0.9799 0.9799 0.9799];
qu =[0.1205 0.1205 0.0798 0.0499 0.0499 0.0499 0.0399 0.0399 0.0399 0.0399 0.04 0.04 0.04 ...
    0.0201 0.0201 0.0201 0.0201 0.0099 0.0099 0.0099 0.0099 0.0099 0.0099 0.1002 0.1002 ...
    0.1002 0.1002 0.0201 0.0201 0.0201 0.0201 0.0201];
s = ones(1,32);
k = 1;
kk = 1;
for i = 1:32
    for j = 1:32
        if i ~= j
            s(i) = 0;
            s(j) = 0;
            pout(kk) = sum(p0.*s);
            deltap = pout(kk) - 2850*rate;
            if deltap < 0
                ss(k,:) = s(1:end);
                lossp(k) = abs(deltap);
                k = k+1;
            end
            s = ones(1,32);
            kk = kk+1;
        end
    end
end

if exist('ss') == 1
    [M,N] = size(ss);
    for i = 1:M
        for j =1:N
            if ss(i,j) == 0
                sj(i,j)  = qu(j);
            else sj(i,j) = qa(j);
            end
        end
    end
    tmp = ones(M,1);
    for i =1:N
        tmp = tmp .*sj(:,i);
    end
    EENS = sum(tmp.*lossp')/2;
    LOLP = sum(tmp)/2;
else
    EENS = 0;
    LOLP = 0;
end
end
